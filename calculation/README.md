# 实验一 简单计算器

## 1 .需求分析

按照四则运算加、减、乘、除、幂（^）和括号的优先关系和惯例，编写计算器程序。要求：

①  从键盘输入一个完整的表达式，以回车作为表达式输入结束的标志。

②  输入表达式中的数值均为大于等于零的整数。中间的计算过程如果出现小数也只取整。

## 2.概要设计

对于简单计算器，采用的抽象数据类型为栈。将输入的数据分为数字栈和运算符栈两种。根据符号自身的优先顺序（调用判断函数）和利用数据后进先出的特性，完成数据的入栈出栈操作和计算。

## 3.详细设计

### 对于简单计算器

先定义栈的结构体，预设空间长度、预设追加空间长度。

除了主函数外，还包括以下几种函数：计算函数、比较符号优先关系函数、入运算符栈函数、入数字栈函数、检查括号运算结束函数。

计算函数：传入参数为数字栈和运算符栈，没有返回值。

* 根据运算符栈最后的符号，对数字栈中倒数一二位进行相应运算，然后将结果储存在数字栈。

比较符号优先关系函数：传入参数为符号栈中最后一位符号和新读入的符号，返回值是‘<’、'>'或‘=’。

* 预先将+、-、*、/、（、）、^七种符号的优先关系用表格形式整理，并采用二维数组储存这种关系。
* 调用函数时，根据传入符号，确定对应二维数组的行列，得到两者之间关系并返回主函数。

入数字栈函数：传入参数为数字、数字栈和标记值，没有返回值。

* 标记值用于确定是否输入了两位或两位以上数字（因为主函数采取的输入方式为逐个读入），并据此纠正上一次存入数字。

* 调用函数时，先检查是否满栈，若是则追加空间。再检查标记值是否为1。则若为1，则直接存入数字。否则，在上一个储存数字基础上乘以十倍再加上新增数字。

入运算符栈函数：传入参数为字符、运算符栈，没有返回值

* 调用函数时，先检查是否满栈，若是则追加空间。此后，储存运算符。

检查括号结束函数：传入参数为字符、运算符栈，没有返回值

* 调用函数时，检查字符是否为“）”，若是，则弹出运算符栈最后一个运算符。否则，调用入运算符栈函数。

主函数：

* 先创建数字栈和运算符栈，并分配预设空间。初始标记值flag=1。然后以换行符为终止标志，逐个读取输入值，若是数字则调用入数字栈函数并且flag加1。若是运算符则先判断是否为首个字符，同时初始化flag=1。若是则直接存入，否则调用比较符号优先关系函数，并根据返回结果采取：'<'调用入运算符栈函数，'>'调用计算函数和检查括号结束函数，'='删去运算符栈最后一个运算符。最后对剩余数字和运算符进行计算，输出结果，释放栈的空间，最后结束程序。

## 4.调试分析

问题：在表达式计算输出中有时会出现非常庞大的数（混乱的）

解决过程和办法：在跟踪调试中发现数字栈储存了在输入之外的数，原来是判断条件中使用了连续不等式（'0'<= x <='9'） ，修正后（'0' <= _&&_ <= '9'）问题解决。

经验总结：不能想当然地书写程序，要遵守语言的特性。
